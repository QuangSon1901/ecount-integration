<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THG — Chi Tiet Khach Hang</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
:root {
    --primary:#2563eb; --primary-dark:#1d4ed8; --primary-light:#eff6ff;
    --success:#10b981; --success-light:#d1fae5;
    --warning:#f59e0b; --warning-light:#fef3c7;
    --danger:#ef4444; --danger-light:#fee2e2;
    --bg-primary:#ffffff; --bg-secondary:#f8fafc;
    --border:#e2e8f0;
    --text-primary:#0f172a; --text-secondary:#64748b;
}
body {
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
    background:var(--bg-secondary); color:var(--text-primary); line-height:1.6;
    min-height:100vh;
}

/* ─── Top Bar ─── */
.topbar {
    background:var(--bg-primary); border-bottom:1px solid var(--border);
    padding:16px 32px; display:flex; align-items:center;
    justify-content:space-between; position:sticky; top:0; z-index:50;
}
.topbar-left { display:flex; align-items:center; gap:14px; }
.topbar-left a {
    color:var(--text-secondary); text-decoration:none; font-size:14px;
    display:inline-flex; align-items:center; gap:6px;
}
.topbar-left a:hover { color:var(--primary); }
.topbar-left .sep { color:var(--text-secondary); opacity:.4; }
.topbar-left .current { font-weight:600; color:var(--text-primary); font-size:15px; }
.topbar-right { display:flex; align-items:center; gap:12px; }

/* ─── Page ─── */
.page { max-width:960px; margin:32px auto; padding:0 24px; }

/* ─── Content Card (matches dashboard) ─── */
.content-card {
    background:var(--bg-primary); border:1px solid var(--border);
    border-radius:12px; padding:24px; margin-bottom:24px;
}
.card-header {
    display:flex; align-items:center; justify-content:space-between;
    margin-bottom:20px; padding-bottom:16px; border-bottom:1px solid var(--border);
}
.card-title { font-size:18px; font-weight:600; }
.card-subtitle { font-size:14px; color:var(--text-secondary); margin-top:4px; }
.card-actions { display:flex; gap:10px; }

/* ─── Info Box (matches dashboard) ─── */
.info-box {
    background:var(--bg-secondary); border:1px solid var(--border);
    border-radius:8px; padding:4px 20px;
}
.info-row {
    display:flex; justify-content:space-between; align-items:center;
    padding:12px 0; border-bottom:1px solid var(--border);
}
.info-row:last-child { border-bottom:none; }
.info-label { font-size:13px; color:var(--text-secondary); }
.info-value { font-size:14px; font-weight:600; }

/* ─── Badge ─── */
.badge {
    display:inline-block; padding:4px 10px;
    border-radius:6px; font-size:12px; font-weight:600;
}
.badge-success { background:var(--success-light); color:#065f46; }
.badge-warning { background:var(--warning-light); color:#92400e; }
.badge-danger { background:var(--danger-light); color:#991b1b; }
.badge-info { background:#dbeafe; color:#1e40af; }

/* ─── Buttons ─── */
.btn {
    display:inline-flex; align-items:center; gap:8px;
    padding:8px 16px; border:1px solid var(--border); border-radius:8px;
    font-size:14px; font-weight:500; cursor:pointer;
    transition:all .2s; text-decoration:none;
    background:var(--bg-primary); color:var(--text-primary);
}
.btn:hover { background:var(--bg-secondary); }
.btn-primary { background:var(--primary); color:#fff; border-color:var(--primary); }
.btn-primary:hover { background:var(--primary-dark); border-color:var(--primary-dark); }
.btn-danger { background:var(--danger); color:#fff; border-color:var(--danger); }
.btn-danger:hover { background:#dc2626; }
.btn-sm { padding:6px 12px; font-size:13px; }
.btn:disabled { opacity:.5; cursor:not-allowed; }
.btn-ghost { background:transparent; border-color:transparent; color:var(--text-secondary); padding:6px 10px; }
.btn-ghost:hover { background:var(--bg-secondary); color:var(--text-primary); }

/* ─── Credentials ─── */
.cred-list { display:flex; flex-direction:column; gap:12px; }
.cred-item {
    background:var(--bg-secondary); border:1px solid var(--border);
    border-radius:8px; padding:16px 20px;
}
.cred-item-header {
    display:flex; align-items:center; justify-content:space-between;
    margin-bottom:10px;
}
.cred-item-header .badge { flex-shrink:0; }
.cred-client-id {
    display:flex; align-items:center; gap:10px;
}
.cred-client-id code {
    font-family:'Courier New',monospace; font-size:13px;
    word-break:break-all; flex:1;
}
.cred-actions { display:flex; gap:8px; flex-wrap:wrap; }

/* ─── Secret reveal ─── */
.secret-reveal {
    background:var(--success-light); border:1px solid var(--success);
    border-radius:8px; padding:16px 20px; margin-top:16px;
}
.secret-reveal-title { font-size:14px; font-weight:600; color:#065f46; margin-bottom:8px; }
.secret-reveal-value {
    display:flex; align-items:center; gap:10px;
}
.secret-reveal-value code {
    font-family:'Courier New',monospace; font-size:13px;
    word-break:break-all; flex:1; font-weight:600;
}

/* ─── Empty state ─── */
.empty-state { text-align:center; padding:48px 20px; color:var(--text-secondary); }
.empty-title { font-size:16px; font-weight:600; margin-bottom:8px; color:var(--text-primary); }

/* ─── Table ─── */
.table-container { overflow-x:auto; }
.data-table { width:100%; border-collapse:collapse; }
.data-table th {
    text-align:left; padding:12px 16px; font-size:13px; font-weight:600;
    color:var(--text-secondary); background:var(--bg-secondary);
    border-bottom:1px solid var(--border);
}
.data-table td { padding:12px 16px; font-size:14px; border-bottom:1px solid var(--border); }
.data-table tr:hover { background:var(--bg-secondary); }
.td-url { max-width:260px; font-family:'Courier New',monospace; font-size:13px; word-break:break-all; color:var(--primary); }

/* ─── Webhook form ─── */
.webhook-form { display:flex; flex-direction:column; gap:14px; margin-bottom:20px; padding-bottom:20px; border-bottom:1px solid var(--border); }
.webhook-form .row { display:flex; gap:10px; flex-wrap:wrap; }
.webhook-form input {
    width:100%; padding:10px 14px; border:1px solid var(--border); border-radius:8px;
    font-size:14px; outline:none; background:var(--bg-primary);
}
.webhook-form input:focus { border-color:var(--primary); box-shadow:0 0 0 3px rgba(37,99,235,.1); }
.events-checkboxes { display:flex; gap:16px; flex-wrap:wrap; }
.events-checkboxes label { display:flex; align-items:center; gap:6px; font-size:14px; cursor:pointer; }
.events-checkboxes input[type=checkbox] { accent-color:var(--primary); width:16px; height:16px; }

/* ─── Filter bar ─── */
.filter-bar { display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:16px; }
.filter-bar select {
    padding:8px 12px; border:1px solid var(--border); border-radius:8px;
    font-size:13px; outline:none; background:var(--bg-primary);
}
.filter-bar select:focus { border-color:var(--primary); }

/* ─── Log status ─── */
.log-success { color:var(--success); font-weight:600; }
.log-failed { color:var(--danger); font-weight:600; }
.log-pending { color:var(--warning); font-weight:600; }

/* ─── Pagination ─── */
.pagination { display:flex; gap:8px; align-items:center; margin-top:16px; justify-content:center; }
.pagination button {
    padding:6px 14px; border:1px solid var(--border); border-radius:8px;
    background:var(--bg-primary); cursor:pointer; font-size:13px; font-weight:500;
}
.pagination button:hover { background:var(--bg-secondary); }
.pagination button:disabled { opacity:.4; cursor:not-allowed; }
.pagination .page-info { font-size:13px; color:var(--text-secondary); }

/* ─── Alert ─── */
.alert-toast {
    position:fixed; top:24px; right:24px; z-index:999;
    background:var(--bg-primary); border:1px solid var(--border);
    border-radius:10px; padding:14px 20px; max-width:380px;
    box-shadow:0 4px 16px rgba(0,0,0,.12); font-size:14px;
    display:flex; align-items:center; gap:10px;
    transform:translateX(120%); transition:transform .3s ease;
}
.alert-toast.show { transform:translateX(0); }
.alert-toast.success { border-color:var(--success); }
.alert-toast.error { border-color:var(--danger); }
.alert-dot {
    width:8px; height:8px; border-radius:50%; flex-shrink:0;
}
.alert-toast.success .alert-dot { background:var(--success); }
.alert-toast.error .alert-dot { background:var(--danger); }

/* ─── Modal ─── */
.modal-overlay {
    position:fixed; inset:0; background:rgba(0,0,0,.5);
    display:none; align-items:center; justify-content:center;
    z-index:1000;
}
.modal-overlay.show { display:flex; }
.modal {
    background:var(--bg-primary); border-radius:12px; padding:32px;
    width:90%; max-width:520px; max-height:90vh; overflow-y:auto;
    position:relative;
}
.modal h3 { font-size:18px; font-weight:600; margin-bottom:20px; }
.modal-close {
    position:absolute; top:16px; right:16px; background:none; border:none;
    font-size:22px; cursor:pointer; color:var(--text-secondary); line-height:1;
}
.modal-close:hover { color:var(--text-primary); }
.form-group { margin-bottom:16px; }
.form-label { display:block; margin-bottom:6px; font-size:14px; font-weight:500; }
.form-input, .form-select {
    width:100%; padding:10px 14px; border:1px solid var(--border); border-radius:8px;
    font-size:14px; background:var(--bg-primary); color:var(--text-primary); outline:none;
}
.form-input:focus, .form-select:focus {
    border-color:var(--primary); box-shadow:0 0 0 3px rgba(37,99,235,.1);
}
.form-row { display:grid; grid-template-columns:1fr 1fr; gap:16px; }
.modal-actions { display:flex; gap:12px; justify-content:flex-end; margin-top:24px; }

/* ─── Mono ─── */
.mono { font-family:'Courier New',monospace; }

/* ─── Responsive ─── */
@media(max-width:640px) {
    .page { padding:0 12px; margin:16px auto; }
    .topbar { padding:12px 16px; }
    .card-header { flex-direction:column; align-items:flex-start; gap:12px; }
    .form-row { grid-template-columns:1fr; }
    .modal { padding:20px; margin:12px; }
    .cred-actions { flex-direction:column; }
}
</style>
</head>
<body>

<!-- Alert Toast -->
<div id="alertToast" class="alert-toast">
    <span class="alert-dot"></span>
    <span id="alertText"></span>
</div>

<!-- Top Bar -->
<div class="topbar">
    <div class="topbar-left">
        <a href="/extensions/dashboard">&#x2190; Dashboard</a>
        <span class="sep">/</span>
        <span class="current" id="topbarName">Chi tiet khach hang</span>
    </div>
    <div class="topbar-right">
        <span id="roleTag" class="badge badge-info">Admin</span>
        <a href="/logout" class="btn btn-sm">Logout</a>
    </div>
</div>

<!-- Main -->
<div class="page">

    <!-- 1. Customer Info -->
    <div class="content-card">
        <div class="card-header">
            <div>
                <h2 class="card-title" id="customerName">&#x2014;</h2>
                <p class="card-subtitle" id="customerMeta">&#x2014;</p>
            </div>
            <div class="card-actions">
                <button class="btn btn-sm" id="btnEditCustomer">Edit</button>
            </div>
        </div>
        <div class="info-box">
            <div class="info-row">
                <span class="info-label">Customer Code</span>
                <span class="info-value" id="infoCode">&#x2014;</span>
            </div>
            <div class="info-row">
                <span class="info-label">Status</span>
                <span class="info-value" id="infoStatus">&#x2014;</span>
            </div>
            <div class="info-row">
                <span class="info-label">Email</span>
                <span class="info-value" id="infoEmail">&#x2014;</span>
            </div>
            <div class="info-row">
                <span class="info-label">Phone</span>
                <span class="info-value" id="infoPhone">&#x2014;</span>
            </div>
            <div class="info-row">
                <span class="info-label">Environment</span>
                <span class="info-value" id="infoEnv">&#x2014;</span>
            </div>
            <div class="info-row">
                <span class="info-label">Rate Limit (Hour / Day)</span>
                <span class="info-value" id="infoRate">&#x2014;</span>
            </div>
            <div class="info-row">
                <span class="info-label">Webhook</span>
                <span class="info-value" id="infoWebhook">&#x2014;</span>
            </div>
            <div class="info-row">
                <span class="info-label">Bulk Order API</span>
                <span class="info-value" id="infoBulkOrder">&#x2014;</span>
            </div>
            <div class="info-row">
                <span class="info-label">Portal Password</span>
                <span class="info-value" id="infoPortalPw">&#x2014;</span>
            </div>
        </div>
    </div>

    <!-- 1b. Portal Password Management -->
    <div class="content-card">
        <div class="card-header">
            <div>
                <h2 class="card-title">Portal Password</h2>
                <p class="card-subtitle">Reset portal login password for this customer</p>
            </div>
            <div class="card-actions">
                <button class="btn btn-primary btn-sm" id="btnResetPortalPw">Reset Password</button>
            </div>
        </div>
        <p style="font-size:13px;color:var(--text-secondary);">Click "Reset Password" to generate a new random password. The new password will be shown once — copy it and send to the customer.</p>

        <div id="resetPwResult" style="display:none;margin-top:16px;padding:14px;background:var(--success-light);border:1px solid #a7f3d0;border-radius:8px;">
            <div style="font-size:12px;font-weight:600;color:#92400e;margin-bottom:6px;">New Password (copy now — shown only once)</div>
            <div style="display:flex;align-items:center;gap:8px;">
                <code id="resetPwValue" style="font-family:'Courier New',monospace;font-size:15px;font-weight:700;letter-spacing:1px;flex:1;word-break:break-all;"></code>
                <button class="btn btn-sm" id="btnCopyResetPw">Copy</button>
            </div>
        </div>
    </div>

    <!-- 2. Credentials -->
    <div class="content-card">
        <div class="card-header">
            <div>
                <h2 class="card-title">API Credentials</h2>
                <p class="card-subtitle">Client ID &amp; Secret for authentication</p>
            </div>
        </div>

        <div id="credentialsList" class="cred-list">
            <p style="color:var(--text-secondary)">Loading...</p>
        </div>

        <!-- Secret reveal (hidden by default) -->
        <div id="secretRevealBox" class="secret-reveal" style="display:none">
            <div class="secret-reveal-title">New Secret Key &#x2014; save it now, it won't be shown again!</div>
            <div class="secret-reveal-value">
                <code id="newSecretValue">&#x2014;</code>
                <button class="btn btn-sm" id="btnCopyNewSecret">Copy</button>
            </div>
        </div>
    </div>

    <!-- 3. Webhooks -->
    <div class="content-card">
        <div class="card-header">
            <div>
                <h2 class="card-title">Webhooks</h2>
                <p class="card-subtitle">Manage webhook registrations</p>
            </div>
            <button class="btn btn-primary btn-sm" id="btnToggleWebhookForm">+ Add Webhook</button>
        </div>

        <!-- Add form (hidden) -->
        <div id="webhookFormWrap" style="display:none">
            <div class="webhook-form">
                <input type="url" id="whUrl" placeholder="https://your-server.com/webhook" required>
                <input type="text" id="whSecret" placeholder="Secret (min 8 chars)" required>
                <div class="events-checkboxes">
                    <label><input type="checkbox" class="event-cb" value="tracking.updated" checked> tracking.updated</label>
                    <label><input type="checkbox" class="event-cb" value="order.status"> order.status</label>
                    <label><input type="checkbox" class="event-cb" value="order.exception"> order.exception</label>
                </div>
                <div style="display:flex;gap:10px;">
                    <button class="btn btn-primary btn-sm" id="btnSaveWebhook">Save</button>
                    <button class="btn btn-sm" id="btnCancelWebhook">Cancel</button>
                </div>
            </div>
        </div>

        <div id="webhooksTable" class="table-container">
            <p style="color:var(--text-secondary)">Loading...</p>
        </div>
    </div>

    <!-- 4. Webhook Delivery Logs -->
    <div class="content-card">
        <div class="card-header">
            <div>
                <h2 class="card-title">Webhook Delivery Logs</h2>
                <p class="card-subtitle">History of webhook deliveries</p>
            </div>
        </div>

        <div class="filter-bar">
            <select id="filterEvent">
                <option value="">All events</option>
                <option value="tracking.updated">tracking.updated</option>
                <option value="order.status">order.status</option>
                <option value="order.exception">order.exception</option>
            </select>
            <select id="filterStatus">
                <option value="">All statuses</option>
                <option value="success">Success</option>
                <option value="failed">Failed</option>
                <option value="pending">Pending</option>
            </select>
            <button class="btn btn-sm" id="btnRefreshLogs">Reload</button>
        </div>

        <div id="logsTable" class="table-container">
            <p style="color:var(--text-secondary)">Loading...</p>
        </div>

        <div class="pagination">
            <button id="btnPrevPage" disabled>&#x2190; Prev</button>
            <span class="page-info" id="pageInfo">Page 1</span>
            <button id="btnNextPage" disabled>Next &#x2192;</button>
        </div>
    </div>
</div>

<!-- Edit Customer Modal -->
<div id="editModal" class="modal-overlay">
    <div class="modal">
        <button class="modal-close" id="btnCloseEditModal">&times;</button>
        <h3>Edit Customer</h3>

        <div class="form-group">
            <label class="form-label">Customer Name</label>
            <input type="text" class="form-input" id="editName" placeholder="Customer name">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="editEmail" placeholder="Email">
            </div>
            <div class="form-group">
                <label class="form-label">Phone</label>
                <input type="text" class="form-input" id="editPhone" placeholder="Phone number">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-select" id="editStatus">
                    <option value="active">Active</option>
                    <option value="suspended">Suspended</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Webhook</label>
                <select class="form-select" id="editWebhookEnabled">
                    <option value="true">Enabled</option>
                    <option value="false">Disabled</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Bulk Order API</label>
                <select class="form-select" id="editBulkOrderEnabled">
                    <option value="true">Enabled</option>
                    <option value="false">Disabled</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Rate Limit / Hour</label>
                <input type="number" class="form-input" id="editRateHour" min="1">
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label class="form-label">Rate Limit / Day</label>
                <input type="number" class="form-input" id="editRateDay" min="1">
            </div>
            <div class="form-group"></div>
        </div>

        <div class="modal-actions">
            <button class="btn" id="btnCancelEdit">Cancel</button>
            <button class="btn btn-primary" id="btnSaveEdit">Save Changes</button>
        </div>
    </div>
</div>

<script src="/js/customer-detail.js?v=1923"></script>
